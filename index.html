<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Харе Кришна</title>

  <!-- ▸ Подключаем оба шрифта одним запросом ◂ -->
  <link
    href="https://fonts.googleapis.com/css2?family=Bad+Script&family=Great+Vibes&display=swap"
    rel="stylesheet">
  <link id="themeStylesheet" rel="stylesheet" href="style.css">
</head>
<body>

  <!-- ▸ счётчик ◂ -->
  <div class="counter" id="counter">Круги: 0 | Бусины: 0</div>

  <!-- ▸ панель управления ◂ -->
  <div class="controls">
    <input type="range" id="speedSlider" min="1" max="3" value="2" step="1">
    <button id="switchStyle">Сменить стиль</button>
  </div>

  <!-- ▸ текст мантры ◂ -->
  <div class="centered">
    <div class="waviy">
      <span style="--i:1">Харе</span>
      <span style="--i:2">Кришна</span>
      <span style="--i:3">Харе</span>
      <span style="--i:4">Кришна</span><br>
      <span style="--i:5">Кришна</span>
      <span style="--i:6">Кришна</span>
      <span style="--i:7">Харе</span>
      <span style="--i:8">Харе</span><br>
      <span style="--i:9">Харе</span>
      <span style="--i:10">Рама</span>
      <span style="--i:11">Харе</span>
      <span style="--i:12">Рама</span><br>
      <span style="--i:13">Рама</span>
      <span style="--i:14">Рама</span>
      <span style="--i:15">Харе</span>
      <span style="--i:16">Харе</span>
    </div>
  </div>

  <script>
    /* === DOM-элементы === */
    const slider    = document.getElementById('speedSlider');
    const switchBtn = document.getElementById('switchStyle');
    const themeLink = document.getElementById('themeStylesheet');
    const counterEl = document.getElementById('counter');

    /* === счётчики бусин/кругов === */
    let beads  = 0;
    let rounds = 0;

    /* === карта скоростей === */
    const speedMap = { 1:'7s', 2:'5s', 3:'4s' };

    function updateSpeed(){
      const dur  = speedMap[slider.value];           // «4s» | «5s» | «6s»
      const num  = parseFloat(dur);                  // 4 | 5 | 6
      const step = (num/16).toFixed(3)+'s';          // равномерная задержка
      document.documentElement.style.setProperty('--speed', dur);
      document.documentElement.style.setProperty('--step',  step);
    }
    slider.addEventListener('input', updateSpeed);

    /* переключаем тему */
    switchBtn.addEventListener('click',()=>{
      themeLink.href = themeLink.href.endsWith('style.css') ? 'style2.css'
                                                            : 'style.css';
    });

    /* фиксируем завершение каждого цикла */
    document.querySelector('.waviy span[style*="--i:16"]')
      .addEventListener('animationiteration',()=>{
        beads++;
        if(beads>=108){ beads=0; rounds++; }
        counterEl.textContent = `Круги: ${rounds} | Бусины: ${beads}`;
      });

    updateSpeed();     // первичная установка
  </script>
</body>
</html>
