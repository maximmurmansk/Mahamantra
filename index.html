<!doctype html>
<html lang="ru">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Ğ¥Ğ°Ñ€Ğµ ĞšÑ€Ğ¸ÑˆĞ½Ğ°</title>

        <!-- Ğ¨Ğ Ğ˜Ğ¤Ğ¢Ğ« -->
        <link
            href="https://fonts.googleapis.com/css2?family=Bad+Script&family=Great+Vibes&display=swap"
            rel="stylesheet"
        />

        <!-- Ğ¡Ğ’Ğ•Ğ¢Ğ›ĞĞ¯/Ğ¢ĞĞœĞĞĞ¯ Ğ¢Ğ•ĞœĞ -->
        <link id="themeStylesheet" rel="stylesheet" href="style2.css" />

        <!-- Ğ›ĞĞšĞĞ›Ğ¬ĞĞ«Ğ• Ğ”ĞĞ‘ĞĞ’ĞšĞ˜ -->
        <style>
            .centered {
                word-spacing: 0;
                width: 100%;
                max-width: 100vw;
                overflow: hidden;
                flex: 1;
                display: flex;
                justify-content: center;
                align-items: center;
            }
            #triggerArea {
                position: fixed;
                bottom: 0;
                right: 0;
                width: 300px;
                height: 300px;
                z-index: 1001;
                pointer-events: auto;
            }
            #intro span:last-child {
                white-space: nowrap;
            }
        </style>
    </head>
    <body>
        <!-- Ğ¡Ğ§ĞĞ¢Ğ§Ğ˜Ğš -->
        <div class="counter" id="counter">ĞšÑ€ÑƒĞ³Ğ¸: 1 | Ğ‘ÑƒÑĞ¸Ğ½Ñ‹: 1</div>

        <!-- Ğ¡Ğ•Ğ›Ğ•ĞšĞ¢ĞĞ  Ğ¯Ğ—Ğ«ĞšĞ -->
        <select
            id="langSel"
            class="icon-btn"
            style="position: fixed; left: 10px; top: 10px; z-index: 20"
        >
            <option value="ru">ğŸ‡·ğŸ‡ºâ€ƒRu</option>
            <option value="en">ğŸ‡¬ğŸ‡§â€ƒEn</option>
            <option value="pl">ğŸ‡µğŸ‡±â€ƒPl</option>
            <option value="de">ğŸ‡©ğŸ‡ªâ€ƒDe</option>
            <option value="uk">ğŸ‡ºğŸ‡¦â€ƒUk</option>
            <option value="cs">ğŸ‡¨ğŸ‡¿â€ƒCs</option>
            <option value="be">ğŸ‡§ğŸ‡¾â€ƒBe</option>
            <option value="tr">ğŸ‡¹ğŸ‡·â€ƒTr</option>
            <option value="el">ğŸ‡¬ğŸ‡·â€ƒEl</option>
            <option value="ka">ğŸ‡¬ğŸ‡ªâ€ƒKa</option>
            <option value="he">ğŸ‡®ğŸ‡±â€ƒHe</option>
            <option value="yi">ğŸ•â€ƒYi</option>
            <option value="ja">ğŸ‡¯ğŸ‡µâ€ƒJa</option>
            <option value="ko">ğŸ‡°ğŸ‡·â€ƒKo</option>
        </select>

        <!-- ĞŸĞ Ğ˜Ğ’Ğ•Ğ¢Ğ¡Ğ¢Ğ’Ğ˜Ğ• -->
        <div id="intro" class="intro">
            <span>(Ğ´Ğ¶Ğ°Ğ¹Ğ°) Ğ¨Ñ€Ğ¸-ĞšÑ€Ğ¸ÑˆĞ½Ğ°-Ğ§Ğ°Ğ¹Ñ‚Ğ°Ğ½Ğ¸Ñ</span>
            <span>ĞŸÑ€Ğ°Ğ±Ñ…Ñƒ ĞĞ¸Ñ‚ÑŒÑĞ½Ğ°Ğ½Ğ´Ğ°</span>
            <span>Ğ¨Ñ€Ğ¸-ĞĞ´Ğ²Ğ°Ğ¹Ñ‚Ğ° Ğ“Ğ°Ğ´Ğ°Ğ´Ñ…Ğ°Ñ€Ğ°</span>
            <span>Ğ¨Ñ€Ğ¸Ğ²Ğ°ÑĞ°Ğ´Ğ¸-Ğ“Ğ°ÑƒÑ€Ğ°-Ğ‘Ñ…Ğ°ĞºÑ‚Ğ°-Ğ’Ñ€Ğ¸Ğ½Ğ´Ğ°</span>
        </div>

        <!-- ĞšĞĞĞŸĞšĞ˜ Â± Ğ¨Ğ Ğ˜Ğ¤Ğ¢Ğ -->
        <div class="font-ctrl" id="fontCtrl">
            <button id="fInc" class="f-btn">+</button>
            <button id="fDec" class="f-btn">âˆ’</button>
        </div>

        <!-- Ğ¢Ğ Ğ˜Ğ“Ğ“Ğ•Ğ  Ğ”Ğ›Ğ¯ ĞšĞĞĞŸĞĞš -->
        <div id="triggerArea"></div>

        <!-- ĞŸĞĞĞ•Ğ›Ğ¬ Ğ¡ĞšĞĞ ĞĞ¡Ğ¢Ğ˜ / Ğ¢Ğ•ĞœĞ« -->
        <div class="controls">
            <button id="dec" class="spd-btn">âˆ’</button>
            <span id="spdText" class="spd-text">6 Ñ</span>
            <button id="inc" class="spd-btn">+</button>
            <button id="theme" class="icon-btn" aria-label="Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ‚ĞµĞ¼Ñƒ">
                <!-- moon & sun -->
                <svg
                    id="moon"
                    viewBox="0 0 24 24"
                    width="24"
                    height="24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                </svg>
                <svg
                    id="sun"
                    class="hidden"
                    viewBox="0 0 24 24"
                    width="24"
                    height="24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                >
                    <circle cx="12" cy="12" r="5" />
                    <line x1="12" y1="1" x2="12" y2="3" />
                    <line x1="12" y1="21" x2="12" y2="23" />
                    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64" />
                    <line x1="18.36" y1="18.36" x2="19.78" y2="19.78" />
                    <line x1="1" y1="12" x2="3" y2="12" />
                    <line x1="21" y1="12" x2="23" y2="12" />
                    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36" />
                    <line x1="18.36" y1="5.64" x2="19.78" y2="4.22" />
                </svg>
            </button>
        </div>

        <!-- ĞœĞĞĞ¢Ğ Ğ -->
        <div class="centered"><div class="waviy" id="waviy"></div></div>

        <!-- === JAVASCRIPT === -->
        <script>
            /* --------- Ğ¡Ğ§ĞĞ¢Ğ§Ğ˜Ğš ---------- */
            let beads = 1,
                rounds = 1,
                introVisible = true;
            const waviy = document.getElementById("waviy"),
                out = document.getElementById("counter"),
                intro = document.getElementById("intro");
            function updateCounter() {
                out.textContent = `ĞšÑ€ÑƒĞ³Ğ¸: ${rounds} | Ğ‘ÑƒÑĞ¸Ğ½Ñ‹: ${beads}`;
            }

            function onIter() {
                if (introVisible) return;
                if (++beads > 108) {
                    beads = 1;
                    ++rounds;
                    showIntro();
                }
                updateCounter();
            }

            function attachFirstListener() {
                waviy
                    .querySelectorAll("#first")
                    .forEach((el) => el.removeAttribute("id"));
                const first = waviy.querySelector("span");
                if (!first) {
                    setTimeout(attachFirstListener, 100);
                    return;
                }
                first.id = "first";
                first.addEventListener("animationiteration", onIter);
            }

            function showIntro() {
                clearTimeout(showIntro.t);
                introVisible = true;
                intro.classList.remove("hidden");
                waviy.classList.add("paused");
                showIntro.t = setTimeout(() => {
                    intro.classList.add("hidden");
                    waviy.classList.remove("paused");
                    introVisible = false;
                    restartWave();
                    updateCounter();
                }, 10000);
            }

            /* --------- Ğ¡ĞšĞĞ ĞĞ¡Ğ¢Ğ¬ ---------- */
            let speed = 6.0,
                constMin = 2,
                constMax = 9,
                constStep = 0.5,
                spdText = document.getElementById("spdText");
            function setSpeed(restart) {
                document.documentElement.style.setProperty(
                    "--speed",
                    speed + "s",
                );
                document.documentElement.style.setProperty(
                    "--step",
                    (speed / 16).toFixed(3) + "s",
                );
                spdText.textContent = speed.toFixed(1) + " Ñ";
                if (restart) restartWave();
            }
            function restartWave() {
                const spans = waviy.querySelectorAll("span");
                spans.forEach((s) => {
                    s.style.animation = "none";
                    s.offsetHeight;
                    s.style.animation = "waviy var(--speed) infinite";
                    s.style.animationDelay = `calc(var(--step) * ${s.dataset.i})`;
                });
                attachFirstListener();
            }
            function changeSpeed(d) {
                const next = +(speed + d).toFixed(1);
                if (next >= constMin && next <= constMax) {
                    speed = next;
                    setSpeed(true);
                }
            }
            document
                .getElementById("inc")
                .addEventListener("click", () => changeSpeed(+constStep));
            document
                .getElementById("dec")
                .addEventListener("click", () => changeSpeed(-constStep));

            /* --------- Ğ¢Ğ•ĞœĞ ---------- */
            let isLightTheme = true;
            document.getElementById("theme").addEventListener("click", () => {
                const link = document.getElementById("themeStylesheet");
                isLightTheme = !isLightTheme;
                link.href = isLightTheme ? "style2.css" : "style.css";
                document
                    .getElementById("sun")
                    .classList.toggle("hidden", !isLightTheme);
                document
                    .getElementById("moon")
                    .classList.toggle("hidden", isLightTheme);
                restartWave();
                adjustFontSize(waviy.textContent.split(/\s+/).filter(Boolean));
            });

            /* --------- Ğ¨Ğ Ğ˜Ğ¤Ğ¢ ---------- */
            let baseSize,
                fStep = 30,
                fontCtrl = document.getElementById("fontCtrl"),
                fInc = document.getElementById("fInc"),
                fDec = document.getElementById("fDec");
            function updateFontSize() {
                document.documentElement.style.setProperty(
                    "--font-size",
                    `${baseSize}px`,
                );
            }
            function adjustFontSize(words) {
                const test = document.createElement("div");
                test.style.cssText =
                    "position:absolute;visibility:hidden;white-space:nowrap;font-family:'Great Vibes',cursive;font-size:16px;";
                let maxW = 0,
                    wm = window.innerWidth < 768 ? 2 : 4;
                for (let i = 0; i < words.length; i += 4) {
                    test.textContent = words.slice(i, i + 4).join(" ");
                    document.body.appendChild(test);
                    maxW = Math.max(
                        maxW,
                        test.offsetWidth +
                            wm * 2 * Math.min(4, words.length - i),
                    );
                    document.body.removeChild(test);
                }
                const avail = window.innerWidth * 0.9,
                    scale = avail / maxW;
                baseSize = Math.min(Math.floor(16 * scale * 0.95), 80);
                baseSize = Math.max(baseSize, 24);
                updateFontSize();
            }
            fInc.addEventListener("click", () => {
                baseSize += fStep;
                updateFontSize();
                showCtrl();
            });
            fDec.addEventListener("click", () => {
                if (baseSize > 24) {
                    baseSize -= fStep;
                    updateFontSize();
                    showCtrl();
                }
            });

            /* --------- ĞŸĞ°Ğ½ĞµĞ»ÑŒ Ğ¼Ğ°ÑÑˆÑ‚Ğ°Ğ±Ğ° / Ğ°Ğ²Ñ‚Ğ¾ÑĞºÑ€Ñ‹Ñ‚Ğ¸Ğµ ---------- */
            let hideTimer,
                lastShow = 0;
            function showCtrl() {
                if (window.innerWidth < 1024) return;
                const now = performance.now();
                if (now - lastShow < 100) return;
                clearTimeout(hideTimer);
                fontCtrl.classList.add("active");
                lastShow = now;
                hideTimer = setTimeout(
                    () => fontCtrl.classList.remove("active"),
                    4000,
                );
            }
            document
                .getElementById("triggerArea")
                .addEventListener("mousemove", () => showCtrl());
            fontCtrl.addEventListener("mouseenter", () => {
                clearTimeout(hideTimer);
                fontCtrl.classList.add("active");
            });
            fontCtrl.addEventListener("mouseleave", () => {
                hideTimer = setTimeout(
                    () => fontCtrl.classList.remove("active"),
                    4000,
                );
            });

            if (window.innerWidth >= 1024) {
                fontCtrl.classList.add("active");
                setTimeout(() => fontCtrl.classList.remove("active"), 3000);
            }

            /* --------- Ğ¡Ñ‚Ñ€Ğ°Ğ¶ Ğ°Ğ½Ğ¸Ğ¼Ğ°Ñ†Ğ¸Ğ¸ ---------- */
            setInterval(() => {
                const first = waviy.querySelector("#first");
                if (
                    !first ||
                    (getComputedStyle(first).animationPlayState === "paused" &&
                        !introVisible)
                )
                    restartWave();
            }, 5000);

            /* --------- Ğ—ĞĞ“Ğ Ğ£Ğ—ĞšĞ JSON + Ñ€ĞµĞ½Ğ´ĞµÑ€ ---------- */
            let translations = null;
            async function loadTranslations() {
                try {
                    const r = await fetch("translations.json");
                    translations = r.ok ? await r.json() : {};
                } catch (e) {
                    translations = {
                        ru: "Ğ¥Ğ°Ñ€Ğµ ĞšÑ€Ğ¸ÑˆĞ½Ğ° Ğ¥Ğ°Ñ€Ğµ ĞšÑ€Ğ¸ÑˆĞ½Ğ° ĞšÑ€Ğ¸ÑˆĞ½Ğ° ĞšÑ€Ğ¸ÑˆĞ½Ğ° Ğ¥Ğ°Ñ€Ğµ Ğ¥Ğ°Ñ€Ğµ Ğ¥Ğ°Ñ€Ğµ Ğ Ğ°Ğ¼Ğ° Ğ¥Ğ°Ñ€Ğµ Ğ Ğ°Ğ¼Ğ° Ğ Ğ°Ğ¼Ğ° Ğ Ğ°Ğ¼Ğ° Ğ¥Ğ°Ñ€Ğµ Ğ¥Ğ°Ñ€Ğµ",
                    };
                }
                render("ru");
            }
            const sel = document.getElementById("langSel");
            function render(lang = "ru") {
                if (!translations) {
                    setTimeout(() => render(lang), 100);
                    return;
                }
                const txt = translations[lang] || translations.ru,
                    words = txt.split(/\s+/).filter(Boolean);
                let html = "";
                for (let i = 0; i < words.length; i++) {
                    html += `<span style="--i:${(i % 16) + 1}" data-i="${(i % 16) + 1}">${words[i]}</span>`;
                    if ((i + 1) % 4 === 0 && i !== words.length - 1)
                        html += "<br>";
                }
                waviy.innerHTML = html;
                adjustFontSize(words);
                attachFirstListener();
            }
            sel.addEventListener("change", (e) => render(e.target.value));
            window.addEventListener("resize", () =>
                adjustFontSize(waviy.textContent.split(/\s+/).filter(Boolean)),
            );

            /* --------- GO! ---------- */
            setSpeed(false);
            showIntro();
            loadTranslations();
        </script>
    </body>
</html>
